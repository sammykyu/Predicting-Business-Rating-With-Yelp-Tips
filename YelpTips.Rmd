---
title: "Business Rating Prediction Based on Yelp Tips"
author: "Sammy Yu"
date: "November 2, 2015"
output: html_document
---

### Introduction

The tips on the Yelp web site is the insider information provided by the Yelp's users or reviewers. The text of the tips contain the sentiments of the users of how they would recomend for the other users when they use the service or buy a product from a particular business. They can positive or negative and should be consistent with review posted by the same user. In this study, I will try to predict a business overall rating based on only the text of tips to see how the tips can affect the rating or image of the business.

### Methods and Data

To create and train a prediction model for business ratings, I use two datasets, "yelp_academic_dataset_business.json" and "yelp_academic_dataset_tips.json" from [Yelp Dataset Challenge](http://www.yelp.com/dataset_challenge) (Rounds 5 and 6).

Both files are in JSON format. The files will be read, merged and cleaned up before they are used for developing the prediction model.  

#### Reading data
```{r, cache=TRUE, eval=FALSE}
library(jsonlite)
bus <- stream_in(file("yelp_academic_dataset_business.json"))
tips <- stream_in(file("yelp_academic_dataset_tip.json"))

```


#### Text mining on the tip texts
```{r, cache=TRUE, eval=FALSE}
library(NLP)
library(tm)

## set the tip texts as the source
vsource <- VectorSource(tips$text)
tiptexts <- Corpus(vsource)

## cleaning
tiptexts <- tm_map(tiptexts, content_transformer(tolower))
tiptexts <- tm_map(tiptexts, removeNumbers)
tiptexts <- tm_map(tiptexts, removePunctuation)
tiptexts <- tm_map(tiptexts, stripWhitespace)
tiptexts <- tm_map(tiptexts, removeWords, stopwords("english"))
tiptexts <- tm_map(tiptexts, stemDocument)

## create a document-term matrix from the tip texts
dtm <- DocumentTermMatrix(tiptexts)
## remove the terms with more than 99.6% sparcity from the dtm
dtm <- removeSparseTerms(dtm, 0.996)
## save the dtm as a regular matrix for later processing
dtm2 <- as.matrix(dtm)
## add the business ID column to the term matrix
dtm_tips <- cbind(business_id=tips$business_id, as.data.frame(dtm2))

## merge the business ratings with tip terms dataframe
bustips <- merge(bus[,c("business_id","stars")], dtm_tips, by="business_id")
## business ID column is no longer needed
bustips$business_id <- NULL

```

#### Most frequent used terms in tips 
```{r, cache=TRUE, eval=FALSE}
## Find frequent terms
frequency <- colSums(dtm2)
frequency <- sort(frequency, decreasing=TRUE)
## make word cloud
words <- names(frequency)
## show the first 100 most frequent used terms in a word cloud
wordcloud(words[1:100], frequency[1:100])

```


### Results



### Discussion

